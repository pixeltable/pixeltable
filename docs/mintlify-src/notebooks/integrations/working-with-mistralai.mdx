

export const quartoRawHtml =
[`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">input</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr>
<td>What three species of fish have the highest mercury content?</td>
<td>The three species of fish that typically have the highest mercury
content are: 1. King Mackerel 2. Shark 3. Swordfish These fish are often
at the top of the food chain and consume other fish that have
accumulated mercury in their bodies. As a result, they tend to have
higher mercury levels. It's recommended to limit consumption of these
fish, especially for pregnant women, nursing mothers, young children,
and people who eat fish frequently.</td>
</tr>
</tbody>
</table>
`];

[![Kaggle](https://kaggle.com/static/images/open-in-kaggle.svg)](https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-mistralai.ipynb)  
[![Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-mistralai.ipynb)  
<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/release/docs/notebooks/integrations/working-with-mistralai.ipynb" download><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook"></a>

# Working with Mistral AI in Pixeltable

Pixeltable’s Mistral AI integration enables you to access Mistral’s LLM
and other models via the Mistral AI API.

### Prerequisites

-   A Mistral AI account with an API key
    (https://console.mistral.ai/api-keys/)

### Important Notes

-   Mistral AI usage may incur costs based on your Mistral AI plan.
-   Be mindful of sensitive data and consider security measures when
    integrating with external services.

First you’ll need to install required libraries and enter a Mistral AI
API key.


```python
%pip install -qU pixeltable mistralai
```


```python
import os
import getpass

if 'MISTRAL_API_KEY' not in os.environ:
    os.environ['MISTRAL_API_KEY'] = getpass.getpass('Mistral AI API Key:')
```

Now let’s create a Pixeltable directory to hold the tables for our demo.


```python
import pixeltable as pxt

# Remove the 'mistralai_demo' directory and its contents, if it exists
pxt.drop_dir('mistralai_demo', force=True)
pxt.create_dir('mistralai_demo')
```

``` text
Connected to Pixeltable database at: postgresql+psycopg://postgres:@/pixeltable?host=/Users/asiegel/.pixeltable/pgdata
Created directory `mistralai_demo`.
```

``` text
<pixeltable.catalog.dir.Dir at 0x3381254c0>
```

## Messages

Create a Table: In Pixeltable, create a table with columns to represent
your input data and the columns where you want to store the results from
Mistral.


```python
from pixeltable.functions.mistralai import chat_completions

# Create a table in Pixeltable and add a computed column that calls Mistral AI

t = pxt.create_table('mistralai_demo.chat', {'input': pxt.String})

messages = [{'role': 'user', 'content': t.input}]
t.add_computed_column(output=chat_completions(
    messages=messages,
    model='mistral-small-latest',
    model_kwargs={
        # Optional dict with parameters for the Mistral API
        'max_tokens': 300,
        'top_p': 0.9,
        'temperature': 0.7
    }
))
```

``` text
Created table `chat`.
Added 0 column values with 0 errors.
```


```python
# Parse the response into a new column
t.add_computed_column(response=t.output.choices[0].message.content)
```

``` text
Added 0 column values with 0 errors.
```


```python
# Start a conversation
t.insert(input="What three species of fish have the highest mercury content?")
t.select(t.input, t.response).show()
```

``` text
Computing cells: 100%|████████████████████████████████████████████| 3/3 [00:02<00:00,  1.26 cells/s]
Inserting rows into `chat`: 1 rows [00:00, 134.12 rows/s]
Computing cells: 100%|████████████████████████████████████████████| 3/3 [00:02<00:00,  1.26 cells/s]
Inserted 1 row with 0 errors.
```

<div dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

### Learn More

To learn more about advanced techniques like RAG operations in
Pixeltable, check out the [RAG Operations in
Pixeltable](https://pixeltable.readme.io/docs/rag-operations-in-pixeltable)
tutorial.

If you have any questions, don’t hesitate to reach out.
