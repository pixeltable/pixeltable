---
title: 'Building Queries'
description: 'Learn how to query and transform data in Pixeltable using where() and select()'
icon: 'filter'
---

<Note>
This guide builds on tables created in previous sections. Make sure you have:
- The `films` table from [Tables](/docs/fundamentals/tables-and-operations)
</Note>

## Basic Filtering

<Tabs>
  <Tab title="Simple Where">
    Use `where()` to filter rows based on basic conditions:
    ```python
    # Find all films with revenue over $2000M
    films.where(
        films.revenue >= 2000.0
    ).collect()
    ```
    
    <Frame>
    | film_name | year | revenue |
    |-----------|------|---------|
    | Titanic | 1997 | 2257.8 |
    | Avengers: Endgame | 2019 | 2797.5 |
    </Frame>
  </Tab>

  <Tab title="Basic Select">
    Use `select()` to choose specific columns:
    ```python
    # Get just film names and years
    films.select(
        films.film_name, 
        films.year
    ).collect()
    ```

    <Frame>
    | film_name | year |
    |-----------|------|
    | Jurassic Park | 1993 |
    | Titanic | 1997 |
    | Avengers: Endgame | 2019 |
    | Inside Out 2 | 2024 |
    </Frame>
  </Tab>

  <Tab title="Column Naming">
    Rename columns in your results:
    ```python
    # Revenue in billions with custom column name
    films.select(
        films.film_name,
        billions=films.revenue / 1000
    ).collect()
    ```

    <Frame>
    | film_name | billions |
    |-----------|----------|
    | Jurassic Park | 1.0375 |
    | Titanic | 2.2578 |
    | Avengers: Endgame | 2.7975 |
    | Inside Out 2 | 1.4627 |
    </Frame>
  </Tab>
</Tabs>

## Intermediate Queries

<AccordionGroup>
  <Accordion title="Text Filtering" icon="font">
    Work with string data across tables:
    ```python
    # Find conversations about weather
    conversations.where(
        conversations.prompt.contains('weather')
    ).collect()

    # Find films with "Park" in the name
    films.where(
        films.film_name.contains('Park')
    ).collect()
    ```
  </Accordion>

  <Accordion title="Multiple Conditions" icon="filter">
    Combine conditions with `&` (and), `|` (or):
    ```python
    # Recent films with high revenue
    films.where(
        (films.year >= 2000) &
        (films.revenue >= 1500.0)
    ).collect()

    # Films from the 90s or with revenue under $1500M
    films.where(
        (films.year < 2000) |
        (films.revenue < 1500.0)
    ).collect()
    ```
  </Accordion>

  <Accordion title="Sorting Results" icon="arrow-down-wide-short">
    Use `order_by()` to sort results:
    ```python
    # Sort films by revenue (highest first)
    films.order_by(
        films.revenue, 
        asc=False
    ).collect()

    # Sort by year, then revenue
    films.order_by(
        [films.year, films.revenue], 
        asc=[True, False]
    ).collect()
    ```
  </Accordion>
</AccordionGroup>

## Advanced Queries

<CardGroup cols={1}>
  <Card title="Text Analysis" icon="text-size">
    Complex string operations and transformations:
    ```python
    # Analyze text lengths across tables
    conversations.select(
        conversations.prompt,
        prompt_length=conversations.prompt.len(),
        response_length=conversations.answer.len()
    ).collect()

    # Find films with complex text patterns
    films.where(
        films.film_name.like('%: %')  # Films with colons in name
    ).collect()
    ```
  </Card>

  <Card title="Numeric Analysis" icon="calculator">
    Mathematical operations and comparisons:
    ```python
    # Calculate revenue statistics
    films.select(
        avg_revenue=films.revenue.avg(),
        total_revenue=films.revenue.sum(),
        films_count=films.film_name.count()
    ).collect()
    
    # Films above average revenue
    avg_revenue = films.select(
        films.revenue.avg()
    ).collect()[0][0]
    
    films.where(
        films.revenue > avg_revenue
    ).collect()
    ```
  </Card>

  <Card title="Complex Filtering" icon="layer-group">
    Combine multiple operations:
    ```python
    # Find top 3 highest-grossing films since 2000
    films.where(
        films.year >= 2000
    ).order_by(
        films.revenue, 
        asc=False
    ).limit(3).collect()
    
    # Analyze AI responses excluding certain topics
    conversations.where(
        ~(conversations.prompt.contains('weather') | 
          conversations.prompt.contains('joke'))
    ).select(
        conversations.prompt,
        response_length=conversations.answer.len()
    ).collect()
    ```
  </Card>
</CardGroup>

## Key Concepts

<CardGroup cols={2}>
  <Card title="Column References" icon="table-columns">
    Access columns using dot notation (`table.column`) or dictionary syntax (`table['column']`).
  </Card>
  <Card title="Chaining Operations" icon="link">
    Combine `where()`, `select()`, `order_by()`, and `limit()` in any order.
  </Card>
  <Card title="Boolean Logic" icon="code-compare">
    Use `&` (and), `|` (or), and `~` (not) for complex conditions.
  </Card>
  <Card title="Transformations" icon="wand-magic-sparkles">
    Transform data during selection with mathematical and string operations.
  </Card>
</CardGroup>

<Tip>
Build complex queries incrementally by starting with basic filters and adding operations one at a time. This makes debugging easier and helps ensure your query returns the expected results.
</Tip>